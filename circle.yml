machine:
  pre:
    - curl -sSL https://s3.amazonaws.com/circle-downloads/install-circleci-docker.sh | bash -s -- 1.10.0

  services:
    - docker

  environment:
    JENKINS_VERSION: '1.656'
    JENKINS_STABLE_VERSION: '1.642.4'

dependencies:
  override:
    - docker version
    - docker info
    - scripts/buildImage.sh war $JENKINS_VERSION latest Dockerfile
    - scripts/buildImage.sh war $JENKINS_VERSION $JENKINS_VERSION Dockerfile
    - scripts/buildImage.sh war-stable $JENKINS_STABLE_VERSION $JENKINS_STABLE_VERSION Dockerfile
    - scripts/buildImage.sh war $JENKINS_VERSION alpine DockerfileAlpine
    - scripts/buildImage.sh war $JENKINS_VERSION alpine.$JENKINS_VERSION DockerfileAlpine
    - scripts/buildImage.sh war-stable $JENKINS_STABLE_VERSION alpine.$JENKINS_STABLE_VERSION DockerfileAlpine
    - scripts/buildImage.sh war-rc latest rc DockerfileAlpine
    - scripts/buildImage.sh war-stable-rc latest stable-rc DockerfileAlpine
    - scripts/buildImage.sh war-rc 2.0 preview-2.0 DockerfileAlpine
    - scripts/buildImage.sh war-rc 2.0 centos.preview-2.0 Dockerfile

test:
  override:
    - scripts/testImage.sh latest 8090
    - scripts/testImage.sh $JENKINS_VERSION 8100
    - scripts/testImage.sh $JENKINS_STABLE_VERSION 8110
    - scripts/testImage.sh alpine 8120
    - scripts/testImage.sh alpine.$JENKINS_VERSION 8130
    - scripts/testImage.sh alpine.$JENKINS_STABLE_VERSION 8140
    - scripts/testImage.sh rc 8150
    - scripts/testImage.sh stable-rc 8160
    - scripts/testImage.sh preview-2.0 8170
    - scripts/testImage.sh centos.preview-2.0 8180
